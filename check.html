<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MT32-Pi ì‹ ì²­ í™•ì¸</title>
    <meta name="description" content="MT32-Pi ê³µë™ì œì‘ ì‹ ì²­ ë° ë°°ì†¡ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://zzeromin.github.io/mt32-pi-cocreate/check.html">
    <meta property="og:title" content="MT32-Pi ì‹ ì²­ í™•ì¸">
    <meta property="og:description" content="ê³µë™ì œì‘ ì‹ ì²­ ë° ë°°ì†¡ í˜„í™© ì¡°íšŒ">
    <meta property="og:image" content="https://zzeromin.github.io/mt32-pi-cocreate/logo.png">
    <style>
        :root {
            --primary-color: #ffffff;
            --bg-color: #0a0a0a;
            --card-bg: #1a1a1a;
            --text-color: #ffffff;
            --text-muted: #aaaaaa;
            --border-color: #333333;
            --accent-glow: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: var(--card-bg);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border-color);
            width: 100%;
            max-width: 450px;
        }

        .logo-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-container img {
            max-width: 300px;
            width: 100%;
            height: auto;
        }

        h1 {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 30px;
            font-size: 20px;
            font-weight: 700;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-muted);
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 14px;
            background-color: #222;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 16px;
            background-color: var(--primary-color);
            color: #000;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
        }

        #resultArea {
            margin-top: 30px;
            display: none;
        }

        .status-card {
            background: #222;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .status-ì ‘ìˆ˜ì™„ë£Œ {
            background: #333;
            color: #aaa;
        }

        .status-ì…ê¸ˆí™•ì¸ {
            background: #1b5e20;
            color: #a5d6a7;
        }

        .status-ë°œì†¡ì™„ë£Œ {
            background: #0d47a1;
            color: #90caf9;
        }

        .back-link {
            display: block;
            text-align: center;
            margin-top: 25px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 14px;
        }

        /* Timeline Styles */
        .timeline {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
            padding: 20px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            top: 40px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: #333;
            z-index: 1;
        }

        .timeline-step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }

        .step-circle {
            width: 12px;
            height: 12px;
            background: #333;
            border-radius: 50%;
            margin: 0 auto 10px;
            border: 3px solid var(--card-bg);
            transition: all 0.3s ease;
        }

        .step-label {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .timeline-step.active .step-circle {
            background: #fff;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            transform: scale(1.2);
        }

        .timeline-step.active .step-label {
            color: #fff;
            font-weight: 700;
        }

        .timeline-step.completed .step-circle {
            background: #fff;
        }

        .timeline-progress {
            position: absolute;
            top: 40px;
            left: 10%;
            height: 2px;
            background: #fff;
            z-index: 1;
            transition: width 0.5s ease;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="logo-container">
            <img src="logo.png" alt="MT32-Pi Logo">
        </div>
        <h1>ì‹ ì²­ ë° ë°°ì†¡ í˜„í™© ì¡°íšŒ</h1>

        <div id="inputArea">
            <div class="form-group">
                <label>ì‹ ì²­ì ì„±í•¨ ë° ë‹‰ë„¤ì„</label>
                <input type="text" id="checkName" placeholder="ì˜ˆ: í™ê¸¸ë™">
            </div>
            <div class="form-group">
                <label>ì—°ë½ì²˜ ë’¤ 4ìë¦¬</label>
                <input type="tel" id="checkPhone" maxlength="4" placeholder="ì˜ˆ: 5678">
            </div>
            <button onclick="checkStatus()" id="checkBtn">ì¡°íšŒí•˜ê¸°</button>
            <a href="index.html" class="back-link">â† ì‹ ì²­ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>

        <div id="resultArea">
            <div id="timelineArea"></div>
            <div id="statusList"></div>
            <button onclick="location.reload()" style="background: #333; color: #fff; margin-top:20px;">ë‹¤ì‹œ ì¡°íšŒí•˜ê¸°</button>
        </div>

        <!-- ìœ ìš©í•œ ë§í¬ ì„¹ì…˜ ì¶”ê°€ -->
        <div style="margin-top: 40px; border-top: 1px solid var(--border-color); padding-top: 25px;">
            <div style="font-size: 14px; font-weight: 700; color: #fff; margin-bottom: 15px;">ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <a href="https://cafe.naver.com/raspigamer/59338" target="_blank"
                    style="background: #222; padding: 12px; border-radius: 8px; text-decoration: none; color: #aaa; font-size: 13px; text-align: center; border: 1px solid #333;">ğŸ“˜
                    ê³µì‹œ ì‚¬í•­</a>
                <a href="https://cafe.naver.com/raspigamer" target="_blank"
                    style="background: #222; padding: 12px; border-radius: 8px; text-decoration: none; color: #aaa; font-size: 13px; text-align: center; border: 1px solid #333;">ğŸ’¬
                    ì»¤ë®¤ë‹ˆí‹°</a>
            </div>
            <div style="margin-top: 10px;">
                <a href="https://zzeromin.github.io/MT32-Pi-Manual/" target="_blank"
                    style="display: block; background: #222; padding: 12px; border-radius: 8px; text-decoration: none; color: #fff; font-size: 13px; text-align: center; border: 1px solid #444; font-weight: 600;">ğŸ“–
                    MT32-Pi ì„¤ì¹˜ ë° ë§¤ë‰´ì–¼ ë³´ê¸°</a>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = "https://cocreate-backend-114168638882.asia-northeast3.run.app";

        // XSS ë°©ì§€ìš© HTML ì´ìŠ¤ì¼€ì´í•‘ í•¨ìˆ˜
        function escapeHtml(str) {
            if (str === null || str === undefined) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function renderTimeline(currentStage) {
            if (!currentStage) return '';
            const stages = ['ì‹ ì²­/ì…ê¸ˆ', 'ë¶€í’ˆìˆ˜ê¸‰', 'ì œì‘/ê²€ìˆ˜', 'ë°°ì†¡ì‹œì‘'];
            const progressWidth = ((currentStage - 1) / (stages.length - 1)) * 80;

            let html = `
                <div style="font-size: 14px; font-weight: 700; margin-bottom: 20px; color: #fff; text-align:center;">ì „ì²´ ê³µì • í˜„í™©</div>
                <div class="timeline">
                    <div class="timeline-progress" style="width: ${progressWidth}%"></div>
            `;

            stages.forEach((stage, index) => {
                const stepNum = index + 1;
                let statusClass = '';
                if (stepNum < currentStage) statusClass = 'completed';
                else if (stepNum === currentStage) statusClass = 'active';

                html += `
                    <div class="timeline-step ${statusClass}">
                        <div class="step-circle"></div>
                        <div class="step-label">${stage}</div>
                    </div>
                `;
            });

            html += `</div>`;
            return html;
        }

        function renderStatusCard(item, accountInfo) {
            const safeStatus = escapeHtml(item.status);
            const safeTimestamp = escapeHtml(item.timestamp);
            const safeOption = escapeHtml(item.option);
            const safeTotalPrice = parseInt(item.total_price, 10) || 0;
            const safeTrackingNo = escapeHtml(item.tracking_no);
            const safeAccountInfo = escapeHtml(accountInfo);

            return `
                <div class="status-card">
                    <div class="status-badge status-${safeStatus}">${safeStatus}</div>
                    <div style="font-size: 13px; color: #888;">ì‹ ì²­ì¼: ${safeTimestamp}</div>
                    <div style="font-size: 16px; font-weight: 700; margin-top: 8px;">${safeOption}</div>
                    <div style="font-size: 15px; margin-top: 5px;">${safeStatus === 'ì ‘ìˆ˜ì™„ë£Œ' ? 'ê²°ì œ ì˜ˆì •ì•¡' : 'ì…ê¸ˆì•¡'}: <span style="color:#fff; font-weight:700;">${safeTotalPrice.toLocaleString()}ì›</span></div>
                    
                    ${safeTrackingNo ? `
                    <div style="margin-top: 15px; padding: 12px; background: #333; border-radius: 8px; border: 1px solid #444;">
                        <div style="color: #aaa; font-size: 11px; margin-bottom:3px;">ìš´ì†¡ì¥ ë²ˆí˜¸</div>
                        <div style="font-size: 14px; color: #fff; font-weight: 700; display:flex; justify-content:space-between; align-items:center;">
                            ${safeTrackingNo}
                            <a href="https://search.naver.com/search.naver?query=íƒë°°ì¡°íšŒ+${encodeURIComponent(item.tracking_no)}" target="_blank" rel="noopener noreferrer" style="color: #4da6ff; text-decoration: none; font-size: 12px; background: rgba(77,166,255,0.1); padding: 4px 8px; border-radius: 4px;">ì¡°íšŒí•˜ê¸°</a>
                        </div>
                    </div>
                    ` : ''}

                    ${safeStatus === 'ì ‘ìˆ˜ì™„ë£Œ' && safeAccountInfo ? `
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #333;">
                        <div style="color: #aaa; font-size: 12px; margin-bottom: 5px;">ì…ê¸ˆ ê³„ì¢Œ ì•ˆë‚´</div>
                        <div style="font-size: 14px; font-weight: 700; color: #fff; margin-bottom:10px;">${safeAccountInfo}</div>
                        <button onclick="copyAccount('${safeAccountInfo}')" style="width: auto; padding: 8px 15px; font-size: 12px; background: #444; color: #fff; border-radius:6px;">ê³„ì¢Œë²ˆí˜¸ ë³µì‚¬</button>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function checkStatus() {
            const nameEl = document.getElementById('checkName');
            const phoneEl = document.getElementById('checkPhone');
            const btn = document.getElementById('checkBtn');

            if (!nameEl.value || !phoneEl.value) {
                alert('ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            btn.disabled = true;
            btn.innerText = "ì¡°íšŒ ì¤‘...";

            fetch(`${API_BASE}/check_status`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: nameEl.value, phone_last4: phoneEl.value })
            })
                .then(res => res.json())
                .then(data => {
                    const listArea = document.getElementById('statusList');
                    const timelineArea = document.getElementById('timelineArea');
                    const resultArea = document.getElementById('resultArea');
                    const inputArea = document.getElementById('inputArea');

                    listArea.innerHTML = '';
                    timelineArea.innerHTML = '';

                    if (data.results && data.results.length > 0) {
                        // Timeline
                        timelineArea.innerHTML = renderTimeline(data.current_stage);

                        // Cards
                        data.results.forEach(item => {
                            const tempDiv = document.createElement('div');
                            tempDiv.innerHTML = renderStatusCard(item, data.account_info);
                            listArea.appendChild(tempDiv.firstElementChild);
                        });
                    } else {
                        listArea.innerHTML = '<p style="text-align:center; padding: 40px; color:#888;">ì¼ì¹˜í•˜ëŠ” ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }

                    inputArea.style.display = 'none';
                    resultArea.style.display = 'block';
                })
                .catch(err => {
                    alert('ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    btn.disabled = false;
                    btn.innerText = "ì¡°íšŒí•˜ê¸°";
                });
        }

        function copyAccount(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('ê³„ì¢Œë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        }
    </script>
</body>

</html>